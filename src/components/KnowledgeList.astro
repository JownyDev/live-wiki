---
export type KnowledgeListVariant = 'knows' | 'blindspots' | 'reveal';

type Props = {
  label: string;
  items: string[];
  variant?: KnowledgeListVariant;
  emptyText?: string;
};

const { label, items, variant = 'knows', emptyText } = Astro.props as Props;
const hasItems = items.length > 0;
const shouldRender = hasItems || typeof emptyText === 'string';

const className = `knowledge-list knowledge-list--${variant}`;

const iconName = (() => {
  switch (variant) {
    case 'blindspots':
      return 'visibility_off';
    case 'reveal':
      return 'key';
    default:
      return 'visibility';
  }
})();

const containerStyles = {
  knows: 'knowledge-list p-space-5 rounded-md border border-border bg-surface grid gap-space-4',
  blindspots: 'knowledge-list p-space-5 rounded-md border border-border bg-surface grid gap-space-4 opacity-70',
  reveal: 'knowledge-list p-space-5 rounded-md border-2 border-[#2b6cee]/35 bg-[#2b6cee]/8 grid gap-space-4',
};

const labelStyles = {
  knows: 'flex items-center gap-space-2 m-0 text-[0.65rem] font-bold uppercase tracking-[0.14em] text-accent',
  blindspots: 'flex items-center gap-space-2 m-0 text-[0.65rem] font-bold uppercase tracking-[0.14em] text-muted',
  reveal: 'flex items-center gap-space-2 m-0 text-[0.65rem] font-bold uppercase tracking-[0.14em] text-accent',
};

const itemStyles = {
  knows: 'flex items-center gap-space-2 px-3 py-2 rounded-md border border-border bg-surface-muted',
  blindspots: 'flex items-center gap-space-2 px-3 py-2 rounded-md border border-border bg-[#1e232e]/35 border-dashed',
  reveal: 'flex items-center gap-space-2 px-3 py-2 rounded-md border border-[#2b6cee]/30 bg-[#2b6cee]/12',
};

const dotStyles = {
  knows: 'w-[0.45rem] h-[0.45rem] rounded-pill bg-accent shrink-0',
  blindspots: 'w-[0.45rem] h-[0.45rem] rounded-pill bg-muted shrink-0',
  reveal: 'w-[0.45rem] h-[0.45rem] rounded-pill bg-accent shrink-0',
};

const textStyles = {
  knows: 'text-[0.85rem] text-text',
  blindspots: 'text-[0.85rem] text-muted italic',
  reveal: 'text-[0.85rem] text-accent-strong font-semibold',
};
---

{shouldRender ? (
  <div class={containerStyles[variant]}>
    <h3 class={labelStyles[variant]}>
      <span class="material-symbols-outlined knowledge-list__icon text-[0.95rem]" aria-hidden="true">
        {iconName}
      </span>
      {label}
    </h3>
    {hasItems ? (
      <ul class="knowledge-list__items list-none m-0 p-0 grid gap-space-2">
        {items.map((item) => (
          <li class={itemStyles[variant]}>
            <span class={dotStyles[variant]} aria-hidden="true"></span>
            <span class={textStyles[variant]}>{item}</span>
          </li>
        ))}
      </ul>
    ) : (
      <p class="knowledge-list__empty m-0 text-[0.9rem] text-muted">{emptyText}</p>
    )}
  </div>
) : null}
