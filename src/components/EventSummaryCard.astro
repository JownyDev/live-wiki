---
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

type Props = {
  title: string;
  preview?: string;
  href?: string;
  date?: string;
  side?: 'left' | 'right';
};

const { title, preview, href, date, side = 'right' } = Astro.props as Props;

// Extract year and rest of date
let year = null;
let restOfDate = null;

if (date) {
  if (date.includes('-')) {
    const parts = date.split('-');
    year = parts[0];
    restOfDate = parts.slice(1).join('-');
  } else {
    year = date;
  }
}
---

<div class={`event-summary-card event-summary-card--${side === 'left' ? 'left' : 'right'}`}>
  {/* The Node on the line */}
  <div class="event-summary-card__dot"></div>
  
  <div class="event-summary-card__grid">
    {/* Left Side */}
    <div class="event-summary-card__date-col">
      {year ? (
        <span class="event-summary-card__year-label">
          {t("event.year")}: {year}
        </span>
      ) : null}
      {restOfDate ? (
        <h3 class="event-summary-card__date-text">
          {restOfDate}
        </h3>
      ) : (year ? null : (
        <h3 class="event-summary-card__date-text">
          {date}
        </h3>
      ))}
    </div>

    {/* Right Side (The Card) */}
    <div class="event-summary-card__panel-col">
      {href ? (
        <a href={href} class="event-summary-card__panel block">
          <div class="event-summary-card__header">
            <h4 class="event-summary-card__title">
              {title}
            </h4>
          </div>
          
          {preview ? (
            <p class="event-summary-card__description">
              {preview}
            </p>
          ) : null}
        </a>
      ) : (
        <div class="event-summary-card__panel">
          <div class="event-summary-card__header">
            <h4 class="event-summary-card__title">
              {title}
            </h4>
          </div>
          
          {preview ? (
            <p class="event-summary-card__description">
              {preview}
            </p>
          ) : null}
        </div>
      )}
    </div>
  </div>
</div>
