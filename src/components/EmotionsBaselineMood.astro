---
export type BaselineMoodItem = {
  label: string;
  value: number;
  tone?: string;
};

type Props = {
  items: BaselineMoodItem[];
};

const { items } = Astro.props as Props;
const hasItems = items.length > 0;
const normalizeTone = (tone?: string): string | null => {
  if (!tone) {
    return null;
  }
  const normalized = tone
    .trim()
    .toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '');
  const toneMap: Record<string, string> = {
    calm: 'calm',
    calma: 'calm',
    trust: 'trust',
    confianza: 'trust',
    irritation: 'irritation',
    irritacion: 'irritation',
  };
  return toneMap[normalized] ?? null;
};
---

{hasItems ? (
  <div class="emotions-baseline">
    <h3 class="emotions-baseline__title">
      <span class="material-symbols-outlined emotions-baseline__icon" aria-hidden="true">
        mood
      </span>
      Estado de animo base
    </h3>
    <div class="emotions-baseline__list">
      {items.map((item) => {
        const toneClass = normalizeTone(item.tone);
        const className = toneClass
          ? `emotions-baseline__bar emotions-baseline__bar--${toneClass}`
          : 'emotions-baseline__bar';
        return (
          <div class="emotions-baseline__item">
            <div class="emotions-baseline__meta">
              <span class="emotions-baseline__label">{item.label}</span>
              <span class="emotions-baseline__value">{item.value}%</span>
            </div>
            <div class="emotions-baseline__track">
              <div class={className} style={`width: ${item.value}%`}></div>
            </div>
          </div>
        );
      })}
    </div>
  </div>
) : null}

<style>
  .emotions-baseline {
    padding: var(--space-4);
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    background: var(--color-surface);
    display: grid;
    gap: var(--space-3);
  }

  .emotions-baseline__title {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin: 0;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--color-accent);
  }

  .emotions-baseline__icon {
    font-size: 0.9rem;
  }

  .emotions-baseline__list {
    display: grid;
    gap: var(--space-3);
  }

  .emotions-baseline__meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.75rem;
  }

  .emotions-baseline__label {
    color: var(--color-muted);
    font-weight: 600;
  }

  .emotions-baseline__value {
    color: var(--color-text);
    font-weight: 700;
  }

  .emotions-baseline__track {
    height: 0.45rem;
    border-radius: var(--radius-pill);
    background: var(--color-surface-muted);
    overflow: hidden;
  }

  .emotions-baseline__bar {
    height: 100%;
    border-radius: var(--radius-pill);
    background: var(--color-accent);
  }

  .emotions-baseline__bar--calm {
    background: #34d399;
  }

  .emotions-baseline__bar--trust {
    background: var(--color-accent);
  }

  .emotions-baseline__bar--irritation {
    background: #f59e0b;
  }
</style>
