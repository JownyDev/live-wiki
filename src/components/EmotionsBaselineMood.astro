---
import { Icon } from 'astro-icon/components';
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

export type BaselineMoodItem = {
  label: string;
  value: number;
  tone?: string;
};

type Props = {
  items: BaselineMoodItem[];
};

const { items } = Astro.props as Props;
const hasItems = items.length > 0;

const normalizeTone = (tone?: string): string | null => {
  if (!tone) {
    return null;
  }
  const normalized = tone
    .trim()
    .toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '');
  const toneMap: Record<string, string> = {
    calm: 'calm',
    calma: 'calm',
    trust: 'trust',
    confianza: 'trust',
    irritation: 'irritation',
    irritacion: 'irritation',
  };
  return toneMap[normalized] ?? null;
};

const barColorStyles: Record<string, string> = {
  calm: 'bg-[#34d399]',
  trust: 'bg-accent',
  irritation: 'bg-[#f59e0b]',
};
---

{hasItems ? (
  <div class="emotions-baseline">
    <h3 class="emotions-baseline__title">
      <Icon name="material-symbols:mood" class="emotions-baseline__icon" aria-hidden="true" />
      {t('ui.mood')}
    </h3>
    <div class="emotions-baseline__list">
      {items.map((item) => {
        const toneKey = normalizeTone(item.tone);
        const colorClass = toneKey ? (barColorStyles[toneKey] ?? 'bg-accent') : 'bg-accent';
        const className = `emotions-baseline__bar h-full rounded-pill ${colorClass}`;
        return (
          <div class="emotions-baseline__item">
            <div class="emotions-baseline__meta">
              <span class="emotions-baseline__label">{item.label}</span>
              <span class="emotions-baseline__value">{item.value}%</span>
            </div>
            <div class="emotions-baseline__track">
              <div class={className} style={`width: ${item.value}%`}></div>
            </div>
          </div>
        );
      })}
    </div>
  </div>
) : null}