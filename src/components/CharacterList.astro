---
import { formatOrigin } from '../lib/format';
import { getLangFromUrl, useTranslations } from '../i18n/utils';

import { getRelativeLocaleUrl } from 'astro:i18n';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

export interface CharacterListItem {
  id: string;
  name: string;
  image?: string;
  archetype?: string;
  origin?: string;
  relationship?: string;
  href?: string;
}

interface Props {
  characters: CharacterListItem[];
  variant?: 'default' | 'relations';
}

const { characters, variant = 'default' } = Astro.props;
const isRelations = variant === 'relations';
---

<div class="character-list">
  {/* Table Header */}
  <div class="character-list__header">
    <div class="character-list__col--name character-list__header-col">{t('char.list.name')}</div>
    <div class="character-list__col--origin character-list__header-col">{t('char.list.origin')}</div>
    {isRelations ? (
      <div class="character-list__col--extra character-list__header-col">{t('char.list.relation')}</div>
    ) : (
      <div class="character-list__col--extra character-list__header-col">{t('char.list.class')}</div>
    )}
  </div>

  {/* Table Body */}
  <div class="character-list__body">
    {characters.length === 0 ? (
      <div class="character-list__empty">{t('char.list.empty')}</div>
    ) : (
      characters.map((character) => (
        <a href={character.href || getRelativeLocaleUrl(lang, `/characters/${character.id}`)} class="character-list__item group">
          
          {/* Character Column */}
          <div class="character-list__col--name flex items-center gap-4">
            <div class="character-list__avatar">
              {character.image ? (
                <img src={character.image} alt={character.name} class="character-list__avatar-img" loading="lazy" />
              ) : (
                <div class="character-list__avatar-placeholder">
                  <span class="material-symbols-outlined text-sm">person</span>
                </div>
              )}
            </div>
            <div class="min-w-0">
              <p class="character-list__name">{character.name}</p>
              <p class="character-list__subtext">
                {isRelations ? (character.relationship || t('ui.unknown')) : (character.archetype || t('ui.unknown'))}
              </p>
            </div>
          </div>

          {/* Origin Column */}
          <div class="character-list__col--origin">
            <span class="character-list__text">{formatOrigin(character.origin, lang)}</span>
          </div>

          {/* Third Column (Desktop) */}
          <div class="character-list__col--extra">
            {isRelations ? (
              <span class="character-list__text">{character.relationship || '-'}</span>
            ) : (
              <span class="character-list__text">{character.archetype || '-'}</span>
            )}
          </div>

        </a>
      ))
    )}
  </div>
</div>
