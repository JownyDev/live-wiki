---
export type TabItem = {
  id: string;
  label: string;
  icon?: string;
};

type Props = {
  items: TabItem[];
  defaultTab?: string;
};

const { items, defaultTab } = Astro.props as Props;
const activeTabId = defaultTab || items[0]?.id;
---

<div class="flex flex-col gap-space-5 w-full" data-tabs-container>
  <nav class="flex gap-space-1 border-b border-border pb-px overflow-x-auto no-scrollbar" role="tablist">
    {items.map((item) => (
      <button
        class={`flex items-center gap-space-2 px-space-4 py-space-3 bg-transparent border-none border-b-2 border-transparent text-muted text-[0.9rem] font-semibold cursor-pointer transition-all hover:text-text hover:bg-white/5 rounded-t-sm ${item.id === activeTabId ? 'text-accent border-b-accent' : ''}`}
        role="tab"
        aria-selected={item.id === activeTabId}
        aria-controls={`panel-${item.id}`}
        id={`tab-${item.id}`}
        data-tab-target={item.id}
      >
        {item.icon && <span class="material-symbols-outlined text-[1.1rem]">{item.icon}</span>}
        <span class="whitespace-nowrap">{item.label}</span>
      </button>
    ))}
  </nav>

  <div class="w-full">
    <slot />
  </div>
</div>

<script>
  function initTabs() {
    const containers = document.querySelectorAll('[data-tabs-container]');
    
    containers.forEach(container => {
      const buttons = container.querySelectorAll('[data-tab-target]');
      const panels = container.querySelectorAll('[data-tab-panel]');

      buttons.forEach(button => {
        button.addEventListener('click', () => {
          const targetId = button.getAttribute('data-tab-target');

          // Update buttons
          buttons.forEach(btn => {
            const isActive = btn === button;
            btn.classList.toggle('text-accent', isActive);
            btn.classList.toggle('border-b-accent', isActive);
            btn.classList.toggle('border-transparent', !isActive);
            btn.setAttribute('aria-selected', isActive.toString());
          });

          // Update panels
          panels.forEach(panel => {
            const isTarget = panel.getAttribute('data-tab-panel') === targetId;
            (panel as HTMLElement).hidden = !isTarget;
          });
        });
      });
    });
  }

  initTabs();
  document.addEventListener('astro:after-swap', initTabs);
</script>
