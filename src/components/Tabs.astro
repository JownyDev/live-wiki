---
export type TabItem = {
  id: string;
  label: string;
  icon?: string;
};

type Props = {
  items: TabItem[];
  defaultTab?: string;
};

const { items, defaultTab } = Astro.props as Props;
const activeTabId = defaultTab || items[0]?.id;
---

<div class="tabs" data-tabs-container>
  <nav class="tabs__nav" role="tablist">
    {items.map((item) => (
      <button
        class={`tabs__button ${item.id === activeTabId ? 'tabs__button--active' : ''}`}
        role="tab"
        aria-selected={item.id === activeTabId}
        aria-controls={`panel-${item.id}`}
        id={`tab-${item.id}`}
        data-tab-target={item.id}
      >
        {item.icon && <span class="material-symbols-outlined tabs__icon">{item.icon}</span>}
        <span class="tabs__label">{item.label}</span>
      </button>
    ))}
  </nav>

  <div class="tabs__content">
    <slot />
  </div>
</div>

<style>
  .tabs {
    display: flex;
    flex-direction: column;
    gap: var(--space-5);
    width: 100%;
  }

  .tabs__nav {
    display: flex;
    gap: var(--space-1);
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 1px;
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .tabs__nav::-webkit-scrollbar {
    display: none;
  }

  .tabs__button {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-4);
    background: transparent;
    border: none;
    border-bottom: 2px solid transparent;
    color: var(--color-muted);
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
    border-radius: var(--radius-sm) var(--radius-sm) 0 0;
  }

  .tabs__button:hover {
    color: var(--color-text);
    background: rgba(255, 255, 255, 0.03);
  }

  .tabs__button--active {
    color: var(--color-accent);
    border-bottom-color: var(--color-accent);
  }

  .tabs__icon {
    font-size: 1.1rem;
  }

  /* We expect children to have data-tab-panel attribute */
  :global([data-tab-panel]) {
    animation: fadeIn 0.3s ease;
  }

  :global([data-tab-panel][hidden]) {
    display: none !important;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>

<script>
  function initTabs() {
    const containers = document.querySelectorAll('[data-tabs-container]');
    
    containers.forEach(container => {
      const buttons = container.querySelectorAll('[data-tab-target]');
      const panels = container.querySelectorAll('[data-tab-panel]');

      buttons.forEach(button => {
        button.addEventListener('click', () => {
          const targetId = button.getAttribute('data-tab-target');

          // Update buttons
          buttons.forEach(btn => {
            const isActive = btn === button;
            btn.classList.toggle('tabs__button--active', isActive);
            btn.setAttribute('aria-selected', isActive.toString());
          });

          // Update panels
          panels.forEach(panel => {
            const isTarget = panel.getAttribute('data-tab-panel') === targetId;
            (panel as HTMLElement).hidden = !isTarget;
          });
        });
      });
    });
  }

  // Handle both initial load and view transitions if enabled
  initTabs();
  document.addEventListener('astro:after-swap', initTabs);
</script>