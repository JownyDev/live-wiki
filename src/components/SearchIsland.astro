---
import searchScript from '../scripts/search-island.ts?url';

const searchEndpoint = '/search.json';
const resultLimit = 12;
const scriptSrc = searchScript;
---

<div
  id="search"
  class="search"
  data-search
  data-search-endpoint={searchEndpoint}
  data-search-limit={resultLimit}
>
  <label class="search__label" for="search-input">Buscar</label>
  <div class="search__control">
    <input
      id="search-input"
      class="search__input"
      type="search"
      name="q"
      placeholder="Buscar por nombre, id o texto..."
      autocomplete="off"
      aria-controls="search-results"
    />
  </div>
  <div class="search__meta">
    <span class="search__status" data-search-status role="status" aria-live="polite">
      Escribe para buscar.
    </span>
  </div>
  <ul id="search-results" class="search__results" data-search-results hidden></ul>
</div>
<script type="module" src={scriptSrc}></script>

<style>
  .search {
    background: var(--search-bg, var(--color-surface));
    border: 1px solid var(--search-border, var(--color-border));
    border-radius: var(--radius-md);
    padding: var(--search-padding, var(--space-4));
    box-shadow: var(--search-shadow, var(--shadow-soft));
  }

  .search__label {
    display: inline-block;
    font-size: var(--text-sm);
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: var(--search-label-color, var(--color-muted));
    margin-bottom: var(--space-2);
  }

  .search__control {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .search__input {
    flex: 1;
    padding: 0.6rem 0.8rem;
    border-radius: var(--radius-sm);
    border: 1px solid var(--search-input-border, var(--color-border));
    font-size: var(--search-input-size, 1rem);
    font-family: var(--font-sans);
    background: var(--search-input-bg, #fffdf9);
    color: var(--search-input-color, var(--color-text));
  }

  .search__input:focus {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  .search__meta {
    margin-top: var(--space-2);
    font-size: var(--text-sm);
    color: var(--search-meta-color, var(--color-muted));
  }

  :global(.search__results) {
    list-style: none;
    margin: var(--space-4) 0 0;
    padding: 0;
    display: grid;
    gap: var(--space-2);
  }

  :global(.search__results[hidden]) {
    display: none;
  }

  :global(.search__result) {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: var(--space-3);
    padding: 0.6rem 0.75rem;
    border-radius: var(--radius-sm);
    border: 1px solid var(--search-result-border, var(--color-border));
    background: var(--search-result-bg, #ffffff);
  }

  :global(.search__result-link) {
    font-family: var(--font-serif);
    font-size: var(--text-lg);
    color: var(--search-result-link, var(--color-text));
    text-decoration: none;
  }

  :global(.search__result-link:hover) {
    color: var(--search-result-link-hover, var(--color-accent));
  }

  :global(.search__result-meta) {
    font-size: var(--text-sm);
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: var(--search-result-meta, var(--color-muted));
  }

  @media (min-width: 900px) {
    .search {
      padding: var(--space-5);
    }
  }
</style>
