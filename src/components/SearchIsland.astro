---
import searchScript from '../scripts/search-island.ts?url';

const searchEndpoint = '/search.json';
const resultLimit = 12;
const scriptSrc = searchScript;
---

<div
  id="search"
  class="search"
  data-search
  data-search-endpoint={searchEndpoint}
  data-search-limit={resultLimit}
>
  <label class="search__label" for="search-input">Buscar</label>
  <div class="search__control">
    <input
      id="search-input"
      class="search__input"
      type="search"
      name="q"
      placeholder="Buscar por nombre, id o texto..."
      autocomplete="off"
      aria-controls="search-results"
    />
  </div>
  <div class="search__meta">
    <span class="search__status" data-search-status role="status" aria-live="polite">
      Escribe para buscar.
    </span>
  </div>
  <ul id="search-results" class="search__results" data-search-results hidden></ul>
</div>
<script type="module" src={scriptSrc}></script>

<style>
  .search {
    background: transparent;
    border: none;
    border-radius: var(--radius-md);
    padding: 0;
    box-shadow: none;
    position: relative;
    justify-self: end;
    width: fit-content;
  }

  .search__label {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    border: 0;
  }

  .search__control {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .search__input {
    flex: 1;
    padding: 0.5rem 0.85rem 0.5rem 2rem;
    border-radius: var(--radius-sm);
    border: 1px solid var(--color-border);
    font-size: 0.9rem;
    font-family: var(--font-sans);
    background: var(--color-surface);
    color: var(--color-text);
    min-width: 12rem;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%239da6b9' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: 0.6rem center;
  }

  .search__input:focus {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  .search__meta {
    display: none;
  }

  :global(.search__results) {
    list-style: none;
    margin: var(--space-4) 0 0;
    padding: 0;
    display: grid;
    gap: var(--space-2);
  }

  :global(.search__results[hidden]) {
    display: none;
  }

  :global(.search__result) {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: var(--space-3);
    padding: 0.6rem 0.75rem;
    border-radius: var(--radius-sm);
    border: 1px solid var(--color-border);
    background: var(--color-surface);
  }

  :global(.search__result-link) {
    font-family: var(--font-serif);
    font-size: var(--text-lg);
    color: var(--color-text);
    text-decoration: none;
  }

  :global(.search__result-link:hover) {
    color: var(--color-accent);
  }

  :global(.search__result-meta) {
    font-size: var(--text-sm);
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: var(--color-muted);
  }

  @media (min-width: 900px) {
    .search {
      padding: var(--space-5);
    }
  }
</style>
