---
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

type Props = {
  stance: string;
  note?: string | null;
};

const { stance, note = null } = Astro.props as Props;
const shouldRender = stance.length > 0;
const normalized = stance
  .trim()
  .toLowerCase()
  .normalize('NFD')
  .replace(/[\u0300-\u036f]/g, '');
const stanceMap: Record<string, 'friendly' | 'wary' | 'hostile' | 'neutral'> = {
  friendly: 'friendly',
  amable: 'friendly',
  amigable: 'friendly',
  abierto: 'friendly',
  abierta: 'friendly',
  open: 'friendly',
  wary: 'wary',
  reservado: 'wary',
  reservada: 'wary',
  cauteloso: 'wary',
  cautelosa: 'wary',
  desconfiado: 'wary',
  desconfiada: 'wary',
  guarded: 'wary',
  hostile: 'hostile',
  hostil: 'hostile',
  agresivo: 'hostile',
  agresiva: 'hostile',
  neutral: 'neutral',
  neutro: 'neutral',
  neutra: 'neutral',
  evaluando: 'neutral',
};
const stanceTone = stanceMap[normalized] ?? 'neutral';

const badgeColorStyles: Record<'friendly' | 'wary' | 'hostile' | 'neutral', string> = {
  friendly: 'emotions-toward__badge--friendly',
  wary: 'emotions-toward__badge--wary',
  hostile: 'emotions-toward__badge--hostile',
  neutral: 'emotions-toward__badge--neutral',
};

const baseBadgeStyles = "emotions-toward__badge";
const badgeClass = `${baseBadgeStyles} ${badgeColorStyles[stanceTone]}`;
---

{shouldRender ? (
  <div class="emotions-toward">
    <h3 class="emotions-toward__title">
      <span class="material-symbols-outlined emotions-toward__icon" aria-hidden="true">
        person_pin_circle
      </span>
      {t('ui.stance')}
    </h3>
    <div class="emotions-toward__content">
      <span class={badgeClass}>{stance}</span>
      {note ? <p class="emotions-toward__note">"{note}"</p> : null}
    </div>
  </div>
) : null}