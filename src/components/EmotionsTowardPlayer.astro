---
type Props = {
  stance: string;
  note?: string | null;
};

const { stance, note = null } = Astro.props as Props;
const shouldRender = stance.length > 0;
const normalized = stance
  .trim()
  .toLowerCase()
  .normalize('NFD')
  .replace(/[\u0300-\u036f]/g, '');
const stanceMap: Record<string, 'friendly' | 'wary' | 'hostile' | 'neutral'> = {
  friendly: 'friendly',
  amable: 'friendly',
  amigable: 'friendly',
  abierto: 'friendly',
  abierta: 'friendly',
  open: 'friendly',
  wary: 'wary',
  reservado: 'wary',
  reservada: 'wary',
  cauteloso: 'wary',
  cautelosa: 'wary',
  desconfiado: 'wary',
  desconfiada: 'wary',
  guarded: 'wary',
  hostile: 'hostile',
  hostil: 'hostile',
  agresivo: 'hostile',
  agresiva: 'hostile',
  neutral: 'neutral',
  neutro: 'neutral',
  neutra: 'neutral',
  evaluando: 'neutral',
};
const stanceTone = stanceMap[normalized] ?? 'neutral';
const badgeClass = `emotions-toward__badge emotions-toward__badge--${stanceTone}`;
---

{shouldRender ? (
  <div class="emotions-toward">
    <h3 class="emotions-toward__title">
      <span class="material-symbols-outlined emotions-toward__icon" aria-hidden="true">
        person_pin_circle
      </span>
      Hacia el jugador
    </h3>
    <div class="emotions-toward__content">
      <span class={badgeClass}>{stance}</span>
      {note ? <p class="emotions-toward__note">"{note}"</p> : null}
    </div>
  </div>
) : null}

<style>
  .emotions-toward {
    padding: var(--space-4);
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    background: var(--color-surface);
    display: grid;
    gap: var(--space-3);
  }

  .emotions-toward__title {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin: 0;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--color-accent);
  }

  .emotions-toward__icon {
    font-size: 0.9rem;
  }

  .emotions-toward__content {
    display: grid;
    place-items: center;
    gap: var(--space-2);
    text-align: center;
    padding: var(--space-2) 0;
  }

  .emotions-toward__badge {
    padding: 0.45rem 1.2rem;
    border-radius: var(--radius-md);
    font-size: 0.9rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    border: 2px solid transparent;
  }

  .emotions-toward__badge--friendly {
    background: rgba(52, 211, 153, 0.15);
    border-color: rgba(52, 211, 153, 0.4);
    color: #34d399;
  }

  .emotions-toward__badge--wary {
    background: rgba(245, 158, 11, 0.12);
    border-color: rgba(245, 158, 11, 0.35);
    color: #f59e0b;
  }

  .emotions-toward__badge--hostile {
    background: rgba(248, 113, 113, 0.12);
    border-color: rgba(248, 113, 113, 0.35);
    color: #f87171;
  }

  .emotions-toward__badge--neutral {
    background: rgba(148, 163, 184, 0.12);
    border-color: rgba(148, 163, 184, 0.35);
    color: #94a3b8;
  }

  .emotions-toward__note {
    margin: 0;
    font-size: var(--text-sm);
    color: var(--color-muted);
    font-style: italic;
  }
</style>
