---
import '../styles/global.css';
import PrimaryNav from '../components/PrimaryNav.astro';
import SearchIsland from '../components/SearchIsland.astro';
import ThemeToggle from '../components/ThemeToggle.astro';
import LanguagePicker from '../components/LanguagePicker.astro';
import { getRelativeLocaleUrl } from 'astro:i18n';
import { useTranslations } from '../i18n/utils';

type Props = {
  title: string;
  lang?: string;
  pageClass?: string;
};

const { title, lang = 'es', pageClass } = Astro.props as Props;
const t = useTranslations(lang as any);
const layoutClass = pageClass ? `layout ${pageClass}` : 'layout';
const homeUrl = getRelativeLocaleUrl(lang, '/');
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{title}</title>
    <script is:inline>
      const theme = localStorage.getItem('theme');
      if (
        theme === 'light' ||
        (!theme && window.matchMedia('(prefers-color-scheme: light)').matches)
      ) {
        document.documentElement.classList.add('light');
      }
    </script>
  </head>
  <body>
    <a class="skip-link" href="#content">
      {t('ui.skip_link')}
    </a>
    <div class={layoutClass}>
      <header class="layout__header">
        <div class="layout__brand">
          <a href={homeUrl}>Live-Wiki</a>
        </div>
        <PrimaryNav />
        <div class="layout__actions">
          <LanguagePicker />
          <SearchIsland />
          <ThemeToggle />
        </div>
      </header>
      <main id="content" class="layout__main">
        <slot />
      </main>
    </div>
  </body>
</html>
