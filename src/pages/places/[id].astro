---
import { getPlaceById, listPlaces } from '../../lib/content/places';
import { listEventsByPlaceId } from '../../lib/content/events';

export async function getStaticPaths() {
  const places = await listPlaces();
  return places.map((place) => ({
    params: { id: place.id },
  }));
}

const id = Astro.params.id;
const place = typeof id === 'string' ? await getPlaceById(id) : null;
const events =
  place && typeof id === 'string' ? await listEventsByPlaceId(id) : [];
const title = place ? place.name : 'Lugar no encontrado';
const planetLabel = (() => {
  if (!place) {
    return 'Desconocido';
  }
  if (place.planetId) {
    return { text: place.planetId, href: `/planets/${place.planetId}` };
  }
  if (place.locationType === 'space') {
    return 'Espacio';
  }
  if (place.locationType === 'planet') {
    return 'Planeta';
  }
  if (place.locationType === 'unknown') {
    return 'Desconocido';
  }
  return 'Desconocido';
})();
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{title}</title>
  </head>
  <body>
    <main>
      {place ? (
        <>
          <h1>{place.name}</h1>
          <section>
            <h2>Planeta</h2>
            {typeof planetLabel === 'string' ? (
              <p>{planetLabel}</p>
            ) : (
              <a href={planetLabel.href}>{planetLabel.text}</a>
            )}
          </section>
          <section>
            <h2>Eventos aqu√≠</h2>
            {events.length === 0 ? (
              <p>Sin eventos.</p>
            ) : (
              <ul>
                {events.map((event) => (
                  <li>
                    <a href={`/events/${event.id}`}>{event.title}</a>
                    <span> ({event.date})</span>
                  </li>
                ))}
              </ul>
            )}
          </section>
          <div style="white-space: pre-wrap;">{place.body}</div>
        </>
      ) : (
        <>
          <h1>Lugar no encontrado</h1>
          <p>El lugar solicitado no existe.</p>
          <p>
            <a href="/places">Volver a lugares</a>
          </p>
        </>
      )}
    </main>
  </body>
</html>
